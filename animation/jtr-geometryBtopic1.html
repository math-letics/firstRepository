 <!DOCTYPE html>
<html>
<style>
#container {
  width: 500px;
  height: 300px;
  position: relative;
  background: lightBlue;
}
#animate {
  width: 30px;
  height: 30px;
  position: absolute;
  bottom: 20px;
  left: 10px;
  background-color: grey;
}
#floor1 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 0px;
}
#water1 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 45px;
}
#floor2 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 155px;
}
#water2 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 195px; 
}
#floor3 {
    width: 40px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 305px;
}
#water3 {
    width: 110px;
    height: 10px;
    position: absolute;
    background: blue;
    bottom: 0px;
    left: 345px; 
}
#floor4 {
    width: 45px;
    height: 30px;
    position: absolute;
    background: green;
    bottom: 0px;
    left: 455px; 
}
#statsDiv {
    position: absolute;
    top: 0px;
    right: 0px;
}
</style>

<script>
  
// global variables
var firstAttempt; // so that the user cannot jump more than once per question
var reset = false; // tells whether or not to reset the position
var numCorrect = 0; // after 3 consecutive correct answers, reset position, maybe increase the level
var level = 1;
var numberAttempted = 0; 
var numberCorrect = 0; 
var percentCorrect;
var temp1, temp2, temp3;
var problem;

/* See if- this is causing the reset problem
// when the enter key is pressed, call the checkanswer feature
document.addEventListener("DOMContentLoaded", function () {
    document.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            checkAnswer();
        }
    });
});
*/

// variables used in this specific webpage
var prime1, prime2, prime3, prime4; // primes that we will multiply
// create arrays to hold groups of primes
var primeArray1 = [2, 3, 5];
var primeArray2 = [2, 3, 5, 7, 11];
var primeArray3 = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37];
var radicand; // the number under the square root
var coefficient, squareRoot; // for the answer

// get values to be used in the problem
function getValues() {
 // use 2, 3, or 4 prime numbers to build a new number
  temp1 = getRandom(0, 2);
  switch (temp1) {
    case 0: use2Primes(); break;
    case 1: use3Primes(); break;
    case 2: use4Primes(); break;
    default: alert('error - main()');
  }

  radicand = prime1*prime2*prime3*prime4; 
} // end of getValues()

// create the answer
function getAnswer() {
    if (prime1 == prime2) {
        if (prime1 == prime3) {
            if (prime1 == prime4) {
                coefficient = prime1*prime1;
                squareRoot = 1;
            }
            else if (prime1 !== prime4) {
                coefficient = prime1;
                squareRoot = prime1*prime4;
            }
            else {alert('error - getAnswer()');}
        }
        else if (prime1 !== prime3) {
            if (prime3 == prime4) {
                coefficient = prime1*prime3;
                squareRoot = 1;
            }
            else if (prime3 !== prime4) {
                coefficient = prime1;
                squareRoot = prime3*prime4;
            }
            else {alert('error - getAnswer()');}
        }
        else {alert('error - getAnswer()');}
    }
    else if (prime1 !== prime2) {
        if (prime2 == prime3) {
            coefficient = prime2;
            squareRoot = prime1*prime4;
        }
        else if (prime2 !== prime3) {
            if (prime3 == prime4) {
                coefficient = prime3;
                squareRoot = prime1*prime2;
            }
            else if (prime3 !== prime4) {
                coefficient = 1;
                squareRoot = prime1*prime2*prime3*prime4;
            }
            else {alert('error - getAnswer()');}
        }
        else {alert('error - getAnswer()');}
    }
    else {alert('error - getAnswer()');}
} // end of getAnswer()

// use 2 primes
function use2Primes() {
  // 1 from primeArray2, 1 from primeArray3
  temp2 = primeArray2.length-1;
  temp1 = getRandom(0, temp2);
  prime1 = primeArray2[temp1];

  temp2 = primeArray3.length-1;
  temp1 = getRandom(0, temp2);
  prime2 = primeArray3[temp1];

  prime3 = 1;
  prime4 = 1;
} // end of use2Primes()

// use 3 primes
function use3Primes() {
  // 2 from primeArray1, 1 from primeArray3
  temp2 = primeArray1.length-1;
  temp1 = getRandom(0, temp2);
  prime1 = primeArray1[temp1];

  temp1 = getRandom(0, temp2);
  prime2 = primeArray1[temp1];

  temp2 = primeArray3.length-1;
  temp1 = getRandom(0, temp2);
  prime3 = primeArray3[temp1];

  prime4 = 1;
} // end of use3Primes

// use 4 primes
function use4Primes() {
  // 3 from primeArray1, 1 from primeArray3
  temp2 = primeArray1.length-1;
  temp1 = getRandom(0, temp2);
  prime1 = primeArray1[temp1];

  temp1 = getRandom(0, temp2);
  prime2 = primeArray1[temp1];

  temp1 = getRandom(0, temp2);
  prime3 = primeArray1[temp1];

  temp2 = primeArray3.length-1;
  temp1 = getRandom(0, temp2);
  prime4 = primeArray3[temp1];
} // end of use4Primes()

// get a new question
function getQuestion() {
  radicand = '&radic;' + '<span style=text-decoration:overline>' + radicand + '</span>';
  
  problem = "Simplify " + radicand +  " completely.";  
} // end of getQuestion()

// answer the question correctly, jump safely
function jumpSafe() {
  var animate = document.getElementById("animate");
  var posLeft = parseInt(animate.style.left) || 10;
  var posBottom = parseInt(animate.style.bottom) || 20;
  var counter = 0;

  var id = setInterval(frame, 5);
  function frame() {
    if (counter < 75) {
      posBottom += 2/3;
    } else if (counter < 150) {
      posBottom -= 2/3;
    }
    posLeft++;
    animate.style.left = posLeft + "px";
    animate.style.bottom = posBottom + "px";

    counter++;
    if (counter >= 150) {
      clearInterval(id);
      giveFeedback();
    }
  }
} // end of jumpSafe()


// incorrect answer, jump fails
function jumpFail() {
  var animate = document.getElementById("animate");
  var posLeft = parseInt(animate.style.left) || 10;
  var posBottom = parseInt(animate.style.bottom) || 20;
  var counter = 0;

  var id = setInterval(frame, 5);
  function frame() {
    if (counter < 55) {
      posBottom += 10/11;
    } else if (counter < 110) {
      posBottom -= 14/11;
    }
    posLeft++;
    animate.style.left = posLeft + "px";
    animate.style.bottom = posBottom + "px";

    counter++;
    if (counter >= 110) {
      clearInterval(id);
      giveFeedback();
    }
  }
} // end of jumpFail()

// reset the position of the animate object
function resetPosition() {
  var animate = document.getElementById("animate");
  animate.style.left = '10px';
  animate.style.bottom = '20px';
} // end of resetPosition()

// get a whole number fact problem
function newProblem() {
    // reset
    document.getElementById('answerInput1').value = '';
    document.getElementById('answerInput2').value = '';
    document.getElementById('feedbackDiv').innerHTML = '&nbsp;';
    document.getElementById('checkButton').style.display = 'inline';
    document.getElementById('answerInput1').style.display = 'inline';
    document.getElementById('answerInput2').style.display = 'inline';
    document.getElementById('closingSpan').style.display = 'inline';
    document.getElementById('radicalSpan').style.display = 'inline';
    firstAttempt = true;
    if (reset) {resetPosition();}
    if (numCorrect > 2) {
        resetPosition(); 
        numCorrect = 0;
        level++;
        document.getElementById('statsDiv').innerHTML = 'Level: ' + level;
    }
    // display the level;
    document.getElementById('statsDiv').innerHTML = 'Level: ' + level;
    
    getValues();
    getAnswer();
    getQuestion();

    // display the problem
    document.getElementById('problemDiv').innerHTML = problem;

    // hide the new problem button so user cannot get an easier problem
    document.getElementById('newButton').style.visibility = 'hidden';
    
    // set focus on the textbox
    document.getElementById('answerInput1').focus();
} // end of newProblem()



// NORMALLY EXTERNAL JS
// generate a random number
function getRandom(min, max) {

    var x = Math.floor(Math.random()*(max - min + 1)) + min;
    // NOTE: using 0.1 and 0.9 as min and max return values of 0.1 or 1.1 every time
    // This code probably only works for whole numbers
    
    return x; 

} // end of getRandom(min, max)

// check the user's answer
function checkAnswer() {
    // validate the form
    var validForm;
    
    // THIS SECTION NEEDS TO INCLUDE TWO INPUTS FROM THE USER
    
    temp1 = document.getElementById('answerInput1').value;
    temp2 = document.getElementById('answerInput2').value;
    
    if (temp1==='' || temp2==='') {
      validForm = false;
      document.getElementById('errorDiv').style.display = 'inline';
    }
    else {validForm = true;}
    
    if (validForm) {
      document.getElementById('checkButton').style.display = 'none';
      document.getElementById('errorDiv').style.display = 'none';
      document.getElementById('newButton').style.visibility = 'visible';
    
      if (firstAttempt) {
          userAnswer1 = document.getElementById('answerInput1').value;
          userAnswer2 = document.getElementById('answerInput2').value;
          
          if (userAnswer1 == coefficient && userAnswer2 == squareRoot && firstAttempt) {
              result = 'correct';        
              document.getElementById('newButton').focus();
              jumpSafe();
              reset = false;
              numCorrect++;
          }
          else if (userAnswer1 !== coefficient || userAnswer2 !== squareRoot) {
              result = 'incorrect';        
              jumpFail();
              reset = true;
              numCorrect = 0;
          }
          else {alert('error - checkAnswer()');}        
      }
      
      firstAttempt = false;
    }    
} // end of checkAnswer()

// give feedback ... set this in the animation function to run after clear(id)
function giveFeedback() {
    if (result === 'correct') {
        document.getElementById('feedbackDiv').innerHTML = 'Correct!';
    }
    else if (result === 'incorrect') {
        temp1 = coefficient + '&radic;(' + squareRoot + ')';
        document.getElementById('feedbackDiv').innerHTML = 'Correct answer: ' + temp1;
        document.getElementById('feedbackDiv').innerHTML += '<br />Try again!';
    }
    else {alert('error - giveFeedback()');}
} // end of giveFeedback()

// load the page
function loadPage() {
    document.getElementById('errorDiv').style.display = 'none';
    document.getElementById('newButton').focus();
    document.getElementById('answerInput1').style.display = 'none';
    document.getElementById('answerInput2').style.display = 'none';
    document.getElementById('closingSpan').style.display = 'none';
    document.getElementById('checkButton').style.display = 'none';
    document.getElementById('radicalSpan').style.display = 'none';
    getStats();
} // end of loadPage()

// get the stats 
function getStats() {
    if (numberAttempted === 0) {percentCorrect = '';}
    else {
        percentCorrect = 100 * numberCorrect / numberAttempted;
        percentCorrect = roundDecimalNumber(percentCorrect, 1);        
    }

    temp1 = 'Level: ' + level;

    document.getElementById('statsDiv').innerHTML = temp1;
} // end of getStats()

// NORMALLY EXTERNAL JS
// round numbers
function roundDecimalNumber(number, places) {

    number = number * Math.pow(10, places);

    number = number.toFixed(0);

    number = number / Math.pow(10, places);

    return number;

} // end of roundDecimalNumber(number, places)

</script>

<body onload='loadPage()'>


  <div id ="container">
  
  <button id='newButton' onclick='newProblem()'>New problem</button>
  
  <br /><br />
  <span id='problemDiv'>Click the button above to get a new problem</span>
  
  <br />
  
  <input type='number' id='answerInput1' style='width: 50px;' />
  <span id='radicalSpan'>&radic;(</span>
  <input type='number' id='answerInput2' style='width: 50px;' />
  <span id='closingSpan'>)</span>
  <button id='checkButton' onclick='checkAnswer()'>Check answer</button>
  <span id='statsDiv'>Stats</span>
  <br />
  <span id='errorDiv' style='color: red;'>Enter an answer above</span>
  <span id='feedbackDiv'>&nbsp;</span>
  <span id='floor1'></span>
  <span id='water1'></span>
  <span id='floor2'></span>
  <span id='water2'></span>
  <span id='floor3'></span>
  <span id='water3'></span>
  <span id='floor4'></span>
  <span id ="animate">The wolf</span>
</div>

</body>
</html>
